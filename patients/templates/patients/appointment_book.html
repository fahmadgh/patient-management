{% extends 'patients/base.html' %}

{% block title %}Book Appointment - Patient Management System{% endblock %}

{% block content %}
<div class="card">
    <h2>Book New Appointment</h2>
    
    {% if available_doctors %}
    <div style="background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem;">
        <strong>üìÖ Available Doctors:</strong> {{ available_doctors.count }} doctor(s) available for appointments
    </div>
    {% else %}
    <div style="background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem;">
        <strong>‚ö†Ô∏è Warning:</strong> No doctors are currently available. Please contact the administrator.
    </div>
    {% endif %}
    
    <form method="post">
        {% csrf_token %}
        
        {% if form.non_field_errors %}
        <div style="background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
            {% for error in form.non_field_errors %}
                <p style="margin: 0;">{{ error }}</p>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="form-group">
            <label for="{{ form.patient.id_for_label }}">Patient *</label>
            {{ form.patient }}
            {% if form.patient.errors %}
                <ul class="errorlist">
                    {% for error in form.patient.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small class="helptext">Select the patient for this appointment</small>
        </div>
        
        <div class="form-group">
            <label for="{{ form.doctor.id_for_label }}">Doctor *</label>
            {{ form.doctor }}
            {% if form.doctor.errors %}
                <ul class="errorlist">
                    {% for error in form.doctor.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small class="helptext">Select an available doctor</small>
        </div>
        
        <div class="form-group">
            <label for="{{ form.appointment_date.id_for_label }}">Appointment Date *</label>
            {{ form.appointment_date }}
            {% if form.appointment_date.errors %}
                <ul class="errorlist">
                    {% for error in form.appointment_date.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small class="helptext">Select the date for the appointment</small>
        </div>
        
        <div class="form-group">
            <label for="{{ form.appointment_time.id_for_label }}">Appointment Time *</label>
            {{ form.appointment_time }}
            {% if form.appointment_time.errors %}
                <ul class="errorlist">
                    {% for error in form.appointment_time.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small class="helptext">Select the time for the appointment (Working hours: 9 AM - 5 PM)</small>
        </div>
        
        <div class="form-group">
            <label for="{{ form.timezone.id_for_label }}">Timezone *</label>
            {{ form.timezone }}
            {% if form.timezone.errors %}
                <ul class="errorlist">
                    {% for error in form.timezone.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small class="helptext">Select your timezone</small>
        </div>
        
        <div class="form-group">
            <label for="{{ form.notes.id_for_label }}">Notes (Optional)</label>
            {{ form.notes }}
            {% if form.notes.errors %}
                <ul class="errorlist">
                    {% for error in form.notes.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small class="helptext">Any additional notes or requirements</small>
        </div>
        
        <div class="btn-group">
            <button type="submit" class="btn btn-success">Book Appointment</button>
            <a href="{% url 'appointment_list' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

{% if available_doctors %}
<div class="card">
    <h2>Available Doctors</h2>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Specialization</th>
                <th>Phone</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody>
            {% for doctor in available_doctors %}
            <tr>
                <td><strong>{{ doctor.get_full_name }}</strong></td>
                <td>{{ doctor.get_specialization_display }}</td>
                <td>{{ doctor.phone_number }}</td>
                <td>{{ doctor.email }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
